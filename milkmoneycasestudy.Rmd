---
title: "Milk and Money Case Study"
author: "Chaman Preet Kaur and Chris Atterbury"
date: "October 5, 2015"
output: pdf_document
---

# Executive Summary
This section is to be written last and contains a short (approx 250 words)
summary of the case study as a whole. 

# Background
The financial success of dairy farms depends on the price of their milk. The case study helps in understanding how milk prices are decided by the federal and state agencies, how payments are made and focuses on different options that farm owners can explore to hedge the price risk against market fluctuations. The simplest approach is to purchase an option or a futures contract from the Chicago Mercantile Exchange on commodity futures that can ensure minimum floor value for their produce. An option on a futures contract is the right, but not the obligation, to buy or sell a futures contract at a specific price on or before an expiration date.  

The price a farm receives for its milk depends on various factors. What the dairy producers actually receive per hundredweight is called the mailbox price.  The farmer (Gerard in this case study) needs to determine which of the options available for trade offer the best hedge for his own milk price or his own mailbox price. The federal order groups milk into four classes: Class I (defined as California Class 1), Class II (California Class 2 and Class 3), Class III (California Class 4b), and Class IV (California Class 4a). Options contracts allow hedgers to establish a price floor without giving up the opportunity to benefit from favorable price changes in the future. Buyers pay a price for the option called the premium up front. There are two different types of options:  

•  Put Options. The right to sell a futures contract at a certain price.  

•	Call Options. The right to buy a futures contract at a certain price.  

The price at which the buyer has the right to buy or sell a futures contract is known as the strike price or exercise price of the option.  Payoff options are described in the following ways:

• At the money. When the price of the underlying security (roughly) equals the strike price. 

• In the money. When holders do gain a profit if the option is exercised. For a put option, the strike price is more than the market price of the underlying security. For a call option, it is when the strike price is less than the market price of the underlying security. 

• Out of the money. When holders do not gain a profit if the option is exercised, so they allow the option to expire unused. The only loss is that of the initial premium and the trading costs of the initial transaction.  

Here we use about three and a half years of data from a dairy farmer named Gerard to determine how he can purchase futures options that will be in the
money if the mailbox price falls below $12.50.  

# Methods
## Initial Considerations
To help Gerard with his put option deliberations, we must analyze the data that
he has collected. We have feature columns _Month_, _Mailbox_, _Class.IV_,
_Class.III_, _Butter_, _NFDM_. Please refer to __Codeblock 1__ in the _Appendix_
to see the first six rows of this data set to get a feel for it. We will not use
the _Month_ column since we are not doing time series analysis, but simply
viewing the data as a collection of measurements of the other feature columns.
Also, we must remove the dollar signs from each of the other columns so that we
can treat them as numeric columns. Please see __Codeblock 2__ in the _Appendix_
for details on this approach, including the code itself. With the preprocessing
done, we can evaluate the data.  

## Determine the Predictor
Gerard plans to purchase put options in just one commodity; the one that is 
most closely related to his mailbox price. To determine this, we will look at 
plots of each variable against each other (see __Figure 1__ in the _Appendix_),
the correlation matrix (see __Codeblock 3__ in the _Appendix_), and simple
linear regression (SLR) models of each of the potential predictors. We will 
evaluate the $R^2$ value, mean squared error ($MSE$), and distribution of the
error terms (see __Codeblock 4__ in the _Appendix_). The results obtained through SLR models were also in conjugation with the p-values of individual variables in the full multiple linear regression model (see __Codeblock 5__ in the _Appendix_). Please see the _Results_ section for an explanation of what we found.  

## Choose put options
We want to choose a put option that leaves Gerard 95% certain that he will
be in the money if the mailbox price falls below $12.50. To obtain this 
certainty, we construct a 95% Confidence Interval and choose the upper 
bound as our target mailbox price (see __Codeblock 6__ in the _Appendix_). 
Using our SLR model for the commodity most closely related to the mailbox price, we determine the strike price needed for the commodity(see
__Codeblock 7__ in the _Appendix_).  See the _Results_ section for an explanation of what we found.  

## Final Adjustments for Fees
Premium and trading fees are a part of purchasing dairy futures options. Thus,
we finish our work with Gerard by accounting for those costs when determining
the desired strike price. Since those fees are subtracted out right away, we
simply increase our strike price so that, after the fees are subtracted, we
still have the price of our commodity guaranteed at a high enough level to be
in the money if the mailbox price falls below $12.50.  


With our methods explained, we look at the results.  

# Results
## Determine the Predictor
While looking at individual SLR models __Class.III__ milk displays the highest __Multiple $R^2$__ value of __0.9268__, followed by __Class.IV__ milk of __0.7121__, __Butter__ of __0.6178__ and __NFDM__ of __0.2961__ (see __Codeblock 4__ in the _Appendix_). The results are in agreement with the correlation matrix and the pairs plot (see __Figure 1__ in the _Appendix_) which show highest __correlation__ between Mailbox and Class.III milk, which is __0.962720__ (see __Codeblock 3__ in the _Appendix_). These results are again confirmed by the full multiple linear regression model (MLR) output (see __Codeblock 5__ in the _Appendix_). The __p-value__ for Class.III milk in the MLR model was the __lowest ($2.73e^{-11}$)__ and the most significant. All these approaches confirmed heirarchical order that Class.III milk was the most related to the mailbox price followed by Class.IV, Butter and NFDM.  

## Choose put options
In an endeavour to choose the correct strike price, the construction of 95% confidence interval using $\hat{Y}_h = 12.50$ yielded __(12.48889, 12.51111)__ as the lower bound and upper bound values. We use the __upper bound__ as our __target mailbox price__ making Gerard 95% sure that he is in the money if mailbox price falls below $12.50. Using mailbox price as 12.51111, we find the Class.III milk price from our previous SLR model developed while calculating the most closesly related commodity to mailbox. This yields a __Class.III__ price of __$13.17__.  

## Final Adjustments for Fees
The __premium fee__ and __transactional cost__ are __constants__ and can be added to the derieved strike price in order to accomodate for extra cost while keeping the model in the money. Hence, we derieve at final strike price by adding the extra premium and transactional costs. 

# Conclusions


Integrate the answers to the questions as seam
lessly as possible. The goal is
that everything is built up to this point so that little justification is needed
and other general conclusions can be included.  

# Appendix
## Codeblocks  
\begin{center} \textbf{Codeblock 1} \end{center}

```{r}
milk <- read.csv("41330727.csv", header = TRUE, stringsAsFactors = FALSE)
head(milk)
```  

\begin{center} \textbf{Codeblock 2} \end{center}

In __Codeblock 1__ we anticipated the need to convert the numeric feature columns.
When being read into the data.frame `milk`, those columns are normally 
interpretated as factors because of the dollar signs. By reading them in as
strings, we can use a regular expression to remove all of the dollar signs, then
convert the columns from character to numeric types. See below for the code
doing this.  

```{r}
for (i in 2:length(milk)) {
  milk[[i]] <- gsub("\\$", "", milk[[i]])
  milk[[i]] <- as.numeric(milk[[i]])
}
```  

\begin{center} \textbf{Codeblock 3} \end{center}

```{r}
cor(milk[2:length(milk)])
```  

\begin{center} \textbf{Codeblock 4} \end{center}

```{r}
lm_classiv <- lm(Mailbox ~ Class.IV, data = milk)
print (summary(lm_classiv))

lm_classiii <- lm(Mailbox ~ Class.III, data = milk)
print (summary(lm_classiii))

lm_butter <- lm(Mailbox ~ Butter, data = milk)
print (summary(lm_butter))

lm_nfdm <- lm(Mailbox ~ NFDM, data = milk)
print (summary(lm_nfdm))
```  

\begin{center} \textbf{Codeblock 5} \end{center}

```{r}
lm_full <- lm(Mailbox ~ ., data = milk[-1])
print (summary(lm_full))
```  

\begin{center} \textbf{Codeblock 6} \end{center}

The code below uses the following equation to determine the upper bound of the
95% Confidence Interval:  

$\hat{Y}_h + t_{(1 - \alpha/2; n - 2)} s\{\hat{Y}_h\}$  

```{r}
s_2 <- anova(lm_classiii)[["Mean Sq"]][[2]]
x_bar <- mean(milk[["Class.III"]])
x_h <- (12.50 - coef(lm_classiii)[[1]]) / coef(lm_classiii)[[2]]
num <- (x_h - x_bar) ^ 2
denom <- sum((milk[["Class.III"]] - x_bar) ^ 2)
val <- 1 / 41 + num / denom
s <- s_2 * val
mbox_upper <- 12.50 + s * qt(0.95, 39)
print (mbox_upper)
```  

\begin{center} \textbf{Codeblock 7} \end{center}

```{r}
b_0 <- coef(lm_classiii)[[1]]
b_1 <- coef(lm_classiii)[[2]]
classiii_price <- (mbox_upper - b_0) / b_1
print (classiii_price)
```  

\begin{center} \textbf{Codeblock 8} \end{center}

```{r}
lm_lclassiii <- lm(Mailbox ~ log(Class.III), data = milk)
print (summary(lm_lclassiii))

lm_classiiil <- lm(log(Mailbox) ~ Class.III, data = milk)
print (summary(lm_classiiil))
```  

## Figures

\begin{center} \textbf{Figure 1} \end{center}

```{r echo=FALSE}
pairs(milk[2:length(milk)], main = "Pairs Plots for Dairy Products")
```  

\begin{center} \textbf{Figure 2} \end{center}

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(car)
scatterplot(Mailbox ~ Class.III, data = milk,
            main = "Scatterplot of Mailbox vs. Class.III",
            xlab = "Class.III Dairy Products Price (dollars)",
            ylab = "Mailbox Price (dollars)",
            boxplot = FALSE)
```  

\begin{center} \textbf{Figure 3} \end{center}

```{r echo=FALSE, warning=FALSE, message=FALSE}
scatterplot(Mailbox ~ log(Class.III), data = milk,
            main = "Scatterplot of Mailbox vs. log(Class.III)",
            xlab = "log of Class.III Dairy Products Price (dollars)",
            ylab = "Mailbox Price (dollars)",
            boxplot = FALSE)
```  

